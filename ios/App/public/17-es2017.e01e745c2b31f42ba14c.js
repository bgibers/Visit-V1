(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{affe:function(t,e,s){"use strict";s.r(e),s.d(e,"NewsFeedPageModule",(function(){return P}));var i=s("TEn/"),n=s("tyNb"),o=s("ofXK"),r=s("3Pt+"),a=s("ykzJ"),c=s("su2D"),l=s("5HCe"),h=s("MCRb"),p=s("IzEk"),b=s("sbzx"),g=s("fXoL"),d=s("e8h1"),u=s("YzH7");let f=(()=>{class t{constructor(t,e,s,i,n,o,r,a,c){this.storage=t,this.modalController=e,this.zone=s,this.cd=i,this.loadingController=n,this.accountService=o,this.postService=r,this.router=a,this.analyticsSvc=c,this.posts=[],this.pageNumber=1,this.morePages=!1,this.filter="",this.selectedUserId="",this.storage.get("image").then(t=>{t?(this.image=t,this.cd.detectChanges()):this.image="../../../assets/defaultuser.png"}),this.analyticsSvc.enableAnalytics(),this.analyticsSvc.setUser()}async ionViewWillEnter(){const t=await this.loadingController.create();await t.present(),this.postService.postsPageGet(this.pageNumber,this.filter,this.selectedUserId).pipe(Object(p.a)(1)).subscribe(async e=>{this.morePages=e.hasNextPage,this.pageNumber=e.pageIndex,this.posts=e.items,this.refresh(),await this.getPosts(1),t.dismiss()},async t=>{401===t.status&&await this.accountService.logout()})}ionViewWillLeave(){this.pageNumber=1,this.morePages=!1}async getPosts(t,e){return new Promise(s=>{this.morePages?this.postService.postsPageGet(this.pageNumber+t,this.filter,this.selectedUserId).pipe(Object(p.a)(1)).subscribe(t=>{if(this.morePages=t.hasNextPage,this.pageNumber=t.pageIndex,0===this.posts.length)this.posts=[];else{const t=this.posts;this.posts=[];const e=t.length;for(let s=0;s<e;s++)this.posts.push(t[s])}const i=t.items.length;for(let e=0;e<i;e++)this.posts.push(t.items[e]);e&&e.target.complete(),this.refresh(),s("done")},async t=>{console.log(t),401===t.status&&(await this.accountService.logout(),s("done"))}):(s("done"),this.infiniteScroll.disabled=!this.infiniteScroll.disabled)})}refreshPosts(t){this.postService.postsPageGet(1,this.filter,this.selectedUserId).pipe(Object(p.a)(1)).subscribe(e=>{this.morePages=e.hasNextPage,this.pageNumber=e.pageIndex,this.posts=e.items,t&&t.target.complete()},async t=>{console.log(t),401===t.status&&await this.accountService.logout()})}async presentSearchModal(){const t=await this.modalController.create({component:a.a,componentProps:{},showBackdrop:!0,cssClass:"search-modal"});return await t.present()}openProfile(){const t={replaceUrl:!0,skipLocationChange:!0,state:{userId:this.accountService.getUserId()}};this.zone.run(()=>{this.router.navigateByUrl("/user-profile",t)})}async presentMapFilter(){const t=await this.modalController.create({component:c.a,showBackdrop:!0,cssClass:"filter-modal",componentProps:{filter:this.filter}});return t.onDidDismiss().then(async t=>{const e=await this.loadingController.create();await e.present(),null!==t?(this.filter=t.data,this.refreshPosts(),this.refresh(),await e.dismiss()):this.refreshPosts()}),await t.present()}refresh(){this.cd.detectChanges()}}return t.\u0275fac=function(e){return new(e||t)(g.Lb(d.b),g.Lb(i.V),g.Lb(g.z),g.Lb(g.h),g.Lb(i.U),g.Lb(l.a),g.Lb(h.b),g.Lb(n.g),g.Lb(b.a))},t.\u0275cmp=g.Fb({type:t,selectors:[["news-feed"]],viewQuery:function(t,e){var s;1&t&&g.xc(i.u,!0),2&t&&g.mc(s=g.Zb())&&(e.infiniteScroll=s.first)},decls:25,vars:3,consts:[[2,"background-color","#128c7e"],["color","#128C7E"],[1,"header-grid"],[1,"ion-align-items-baseline"],[1,"ion-justify-content-start"],[1,"ion-justify-content-start","circle-pic",3,"click"],[3,"src"],[1,"ion-justify-self-bottom"],["height","60px","width","120px","src","../../assets/logos/whiteLogo.png"],[1,"ion-justify-content-end"],[1,"ion-justify-content-end",3,"click"],["src","../../assets/UI/search-outline.svg",1,"img-center"],["color","light",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["refresherRef",""],["pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],[3,"posts"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","circles","loadingText","Getting more posts..."],["vertical","bottom",1,"map-filter-fab"],["fill","clear",3,"click"],["src","../../assets/UI/FilterClosed.svg"]],template:function(t,e){1&t&&(g.Qb(0,"ion-header",0),g.Qb(1,"ion-toolbar",1),g.Qb(2,"ion-grid",2),g.Qb(3,"ion-row",3),g.Qb(4,"ion-col",4),g.Qb(5,"ion-buttons",4),g.Qb(6,"ion-button",5),g.Yb("click",(function(){return e.openProfile()})),g.Qb(7,"ion-avatar"),g.Mb(8,"img",6),g.Pb(),g.Pb(),g.Pb(),g.Pb(),g.Qb(9,"ion-col",7),g.Mb(10,"img",8),g.Pb(),g.Qb(11,"ion-col",9),g.Qb(12,"ion-buttons",9),g.Qb(13,"ion-button",10),g.Yb("click",(function(){return e.presentSearchModal()})),g.Mb(14,"img",11),g.Pb(),g.Pb(),g.Pb(),g.Pb(),g.Pb(),g.Pb(),g.Pb(),g.Qb(15,"ion-content",12),g.Qb(16,"ion-refresher",13,14),g.Yb("ionRefresh",(function(t){return e.refreshPosts(t)})),g.Mb(18,"ion-refresher-content",15),g.Pb(),g.Mb(19,"post",16),g.Qb(20,"ion-infinite-scroll",17),g.Yb("ionInfinite",(function(t){return e.getPosts(1,t)})),g.Mb(21,"ion-infinite-scroll-content",18),g.Pb(),g.Pb(),g.Qb(22,"ion-fab",19),g.Qb(23,"ion-button",20),g.Yb("click",(function(){return e.presentMapFilter()})),g.Mb(24,"img",21),g.Pb(),g.Pb()),2&t&&(g.Ab(8),g.ic("src",e.image,g.pc),g.Ab(7),g.hc("fullscreen",!1),g.Ab(4),g.hc("posts",e.posts))},directives:[i.s,i.Q,i.r,i.G,i.l,i.g,i.f,i.c,i.m,i.D,i.E,u.a,i.u,i.v,i.o],styles:["ion-content[_ngcontent-%COMP%]{--background:translucent}ion-toolbar[_ngcontent-%COMP%]{--min-height:2%!important;--padding-top:10px}.circle-pic[_ngcontent-%COMP%]{width:65px;height:50px;border-radius:50%}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.post-pic[_ngcontent-%COMP%]{--border-radius:75%}.card-title[_ngcontent-%COMP%]{font-size:20px;font-weight:400;padding-bottom:5px}.header-grid[_ngcontent-%COMP%]{--ion-grid-columns:3;--ion-grid-column-padding:1px;--ion-grid-padding:1px}.map-filter[_ngcontent-%COMP%], .map-filter-fab[_ngcontent-%COMP%]{justify-content:center;align-self:center}.btn[_ngcontent-%COMP%]{border:none;background-color:inherit;font-size:16px;display:inline-block}.comment[_ngcontent-%COMP%]{--padding-start:0px;--inner-padding-end:0px;--padding-bottom:0px}"]}),t})();var m=s("PCNd");let P=(()=>{class t{}return t.\u0275mod=g.Jb({type:t}),t.\u0275inj=g.Ib({factory:function(e){return new(e||t)},imports:[[i.S,o.c,r.g,m.a,n.k.forChild([{path:"",component:f}])]]}),t})()}}]);