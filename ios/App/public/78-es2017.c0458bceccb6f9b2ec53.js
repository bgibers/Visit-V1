(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{affe:function(e,t,s){"use strict";s.r(t),s.d(t,"NewsFeedPageModule",(function(){return P}));var i=s("TEn/"),n=s("tyNb"),o=s("ofXK"),c=s("3Pt+"),r=s("ykzJ"),a=s("su2D"),l=s("5HCe"),h=s("MCRb"),g=s("IzEk"),p=s("sbzx"),d=s("fXoL"),u=s("e8h1"),f=s("YzH7");class m{constructor(e,t,s,i,n,o,c,r,a){this.storage=e,this.modalController=t,this.zone=s,this.cd=i,this.loadingController=n,this.accountService=o,this.postService=c,this.router=r,this.analyticsSvc=a,this.posts=[],this.pageNumber=1,this.morePages=!1,this.filter="",this.selectedUserId="",this.storage.get("image").then(e=>{e?(this.image=e,this.cd.detectChanges()):this.image="../../../assets/defaultuser.png"}),this.analyticsSvc.enableAnalytics(),this.analyticsSvc.setUser()}async ionViewDidEnter(){const e=await this.loadingController.create();await e.present(),console.log(`${this.pageNumber}, ${this.filter}, ${this.selectedUserId}`),this.postService.postsPageGet(this.pageNumber,this.filter,this.selectedUserId).pipe(Object(g.a)(1)).subscribe(async t=>{this.morePages=t.hasNextPage,this.pageNumber=t.pageIndex,this.posts=t.items,this.refresh(),await this.getPosts(1),e.dismiss()},async t=>{401===t.status&&(e.dismiss(),await this.accountService.logout())})}ionViewWillLeave(){this.pageNumber=1,this.morePages=!1}async getPosts(e,t){return new Promise(s=>{this.morePages?this.postService.postsPageGet(this.pageNumber+e,this.filter,this.selectedUserId).pipe(Object(g.a)(1)).subscribe(e=>{if(this.morePages=e.hasNextPage,this.pageNumber=e.pageIndex,0===this.posts.length)this.posts=[];else{const e=this.posts;this.posts=[];const t=e.length;for(let s=0;s<t;s++)this.posts.push(e[s])}const i=e.items.length;for(let t=0;t<i;t++)this.posts.push(e.items[t]);t&&t.target.complete(),this.refresh(),s("done")},async e=>{console.log(e),401===e.status&&(await this.accountService.logout(),s("done"))}):(s("done"),this.infiniteScroll.disabled=!this.infiniteScroll.disabled)})}refreshPosts(e){this.postService.postsPageGet(1,this.filter,this.selectedUserId).pipe(Object(g.a)(1)).subscribe(t=>{this.morePages=t.hasNextPage,this.pageNumber=t.pageIndex,this.posts=t.items,e&&e.target.complete()},async e=>{console.log(e),401===e.status&&await this.accountService.logout()})}async presentSearchModal(){const e=await this.modalController.create({component:r.a,componentProps:{},showBackdrop:!0,cssClass:"search-modal"});return await e.present()}openProfile(){const e={replaceUrl:!0,skipLocationChange:!0,state:{userId:this.accountService.getUserId()}};this.zone.run(()=>{this.router.navigateByUrl("/user-profile",e)})}async presentMapFilter(){const e=await this.modalController.create({component:a.a,showBackdrop:!0,cssClass:"filter-modal",componentProps:{filter:this.filter}});return e.onDidDismiss().then(async e=>{await this.loadingController.create();null!==e?(this.filter=e.data,this.refreshPosts(),this.refresh()):this.refresh()}),await e.present()}refresh(){this.cd.detectChanges()}}m.\u0275fac=function(e){return new(e||m)(d.cc(u.b),d.cc(i.V),d.cc(d.L),d.cc(d.j),d.cc(i.U),d.cc(l.a),d.cc(h.b),d.cc(n.g),d.cc(p.a))},m.\u0275cmp=d.Wb({type:m,selectors:[["news-feed"]],viewQuery:function(e,t){var s;(1&e&&d.Oc(i.u,!0),2&e)&&(d.Dc(s=d.qc())&&(t.infiniteScroll=s.first))},decls:25,vars:3,consts:[[2,"background-color","#128c7e"],["color","#128C7E"],[1,"header-grid"],[1,"ion-align-items-baseline"],[1,"ion-justify-content-start"],[1,"ion-justify-content-start","circle-pic",3,"click"],[3,"src"],[1,"ion-justify-self-bottom"],["height","60px","width","120px","src","../../assets/logos/whiteLogo.png"],[1,"ion-justify-content-end"],[1,"ion-justify-content-end",3,"click"],["src","../../assets/UI/search-outline.svg",1,"img-center"],["color","light",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["refresherRef",""],["pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],[3,"posts"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","circles","loadingText","Getting more posts..."],["vertical","bottom",1,"map-filter-fab"],["fill","clear",3,"click"],["src","../../assets/UI/FilterClosed.svg"]],template:function(e,t){1&e&&(d.hc(0,"ion-header",0),d.hc(1,"ion-toolbar",1),d.hc(2,"ion-grid",2),d.hc(3,"ion-row",3),d.hc(4,"ion-col",4),d.hc(5,"ion-buttons",4),d.hc(6,"ion-button",5),d.pc("click",(function(){return t.openProfile()})),d.hc(7,"ion-avatar"),d.dc(8,"img",6),d.gc(),d.gc(),d.gc(),d.gc(),d.hc(9,"ion-col",7),d.dc(10,"img",8),d.gc(),d.hc(11,"ion-col",9),d.hc(12,"ion-buttons",9),d.hc(13,"ion-button",10),d.pc("click",(function(){return t.presentSearchModal()})),d.dc(14,"img",11),d.gc(),d.gc(),d.gc(),d.gc(),d.gc(),d.gc(),d.gc(),d.hc(15,"ion-content",12),d.hc(16,"ion-refresher",13,14),d.pc("ionRefresh",(function(e){return t.refreshPosts(e)})),d.dc(18,"ion-refresher-content",15),d.gc(),d.dc(19,"post",16),d.hc(20,"ion-infinite-scroll",17),d.pc("ionInfinite",(function(e){return t.getPosts(1,e)})),d.dc(21,"ion-infinite-scroll-content",18),d.gc(),d.gc(),d.hc(22,"ion-fab",19),d.hc(23,"ion-button",20),d.pc("click",(function(){return t.presentMapFilter()})),d.dc(24,"img",21),d.gc(),d.gc()),2&e&&(d.Rb(8),d.zc("src",t.image,d.Gc),d.Rb(7),d.yc("fullscreen",!1),d.Rb(4),d.yc("posts",t.posts))},directives:[i.s,i.Q,i.r,i.G,i.l,i.g,i.f,i.c,i.m,i.D,i.E,f.a,i.u,i.v,i.o],styles:["ion-content[_ngcontent-%COMP%]{--background:translucent}ion-toolbar[_ngcontent-%COMP%]{--min-height:2%!important;--padding-top:10px}.circle-pic[_ngcontent-%COMP%]{width:65px;height:50px;border-radius:50%}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.post-pic[_ngcontent-%COMP%]{--border-radius:75%}.card-title[_ngcontent-%COMP%]{font-size:20px;font-weight:400;padding-bottom:5px}.header-grid[_ngcontent-%COMP%]{--ion-grid-columns:3;--ion-grid-column-padding:1px;--ion-grid-padding:1px}.map-filter[_ngcontent-%COMP%], .map-filter-fab[_ngcontent-%COMP%]{justify-content:center;align-self:center}.btn[_ngcontent-%COMP%]{border:none;background-color:inherit;font-size:16px;display:inline-block}.comment[_ngcontent-%COMP%]{--padding-start:0px;--inner-padding-end:0px;--padding-bottom:0px}"]});var b=s("PCNd");class P{}P.\u0275mod=d.ac({type:P}),P.\u0275inj=d.Zb({factory:function(e){return new(e||P)},imports:[[i.S,o.c,c.g,b.a,n.k.forChild([{path:"",component:m}])]]})}}]);