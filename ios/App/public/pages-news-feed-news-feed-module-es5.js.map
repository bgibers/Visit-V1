{"version":3,"sources":["webpack:///src/app/pages/news-feed/news-feed.module.ts","webpack:///src/app/pages/news-feed/news-feed.page.ts","webpack:///src/app/pages/news-feed/news-feed.page.html"],"names":["NewsFeedPageModule","forChild","path","component","imports","declarations","NewsFeedPage","modalController","zone","cd","loadingController","accountService","postService","router","posts","pageNumber","morePages","filter","selectedUserId","create","loading","present","postsPageGet","pipe","subscribe","res","hasNextPage","pageIndex","items","refresh","getPosts","dismiss","err","status","logout","incr","event","Promise","resolve","length","oldposts","oldResLen","i","push","resLen","target","complete","console","log","infiniteScroll","disabled","componentProps","showBackdrop","cssClass","modal","navigationExtras","replaceUrl","skipLocationChange","state","userId","getUserId","run","navigateByUrl","onDidDismiss","then","dataReturned","data","refreshPosts","detectChanges","openProfile","presentSearchModal","$event","presentMapFilter","selector","templateUrl","styleUrls"],"mappings":"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","file":"pages-news-feed-news-feed-module-es5.js","sourcesContent":["import { IonicModule } from '@ionic/angular';\nimport { RouterModule } from '@angular/router';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { NewsFeedPage } from './news-feed.page';\nimport { SharedModule } from 'src/app/shared/shared.module';\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    FormsModule,\n    SharedModule,\n    RouterModule.forChild([{ path: '', component: NewsFeedPage }])\n  ],\n  declarations: [\n    NewsFeedPage\n  ]\n})\nexport class NewsFeedPageModule {}\n","import {\n  ChangeDetectorRef,\n  Component,\n  NgZone,\n  OnInit,\n  ViewChild,\n} from \"@angular/core\";\nimport {\n  IonInfiniteScroll,\n  IonRefresher,\n  LoadingController,\n  ModalController,\n} from \"@ionic/angular\";\nimport { SearchPage } from \"../modals/search/search.page\";\nimport { MapFilterPage } from \"../modals/map-filter/map-filter.page\";\nimport { Router, NavigationExtras } from \"@angular/router\";\nimport { AccountsService } from \"../../backend/clients/api/accounts.service\";\nimport { PostService } from \"src/app/backend/clients\";\nimport { PostApi } from \"src/app/backend/clients/model/postApi\";\nimport { take } from \"rxjs/operators\";\nimport { from } from \"rxjs\";\n\n@Component({\n  selector: \"news-feed\",\n  templateUrl: \"news-feed.page.html\",\n  styleUrls: [\"news-feed.page.scss\"],\n})\nexport class NewsFeedPage {\n  @ViewChild(IonInfiniteScroll) infiniteScroll: IonInfiniteScroll;\n\n  posts: PostApi[] = [];\n  pageNumber = 1;\n  morePages = false;\n  filter = \"\";\n  selectedUserId = \"\";\n\n  constructor(\n    public modalController: ModalController,\n    private zone: NgZone,\n    private cd: ChangeDetectorRef,\n    private loadingController: LoadingController,\n    private accountService: AccountsService,\n    private postService: PostService,\n    private router: Router\n  ) {}\n\n  async ionViewWillEnter() {\n    const loading = await this.loadingController.create();\n    await loading.present();\n    this.postService.postsPageGet(this.pageNumber, this.filter, this.selectedUserId).pipe(take(1)).subscribe(async res => {\n      this.morePages = res.hasNextPage;\n      this.pageNumber = res.pageIndex;\n      this.posts = res.items;\n\n      this.refresh();\n      // see if there are more than one page if so get them\n      await this.getPosts(1);\n      loading.dismiss();\n    }, async err => {\n      if (err.status === 401) {\n        await this.accountService.logout();\n      }\n    });\n  }\n\n  async getPosts(incr: number, event?: any) {\n    return new Promise(resolve => {\n      if (this.morePages) {\n        this.postService\n          .postsPageGet(this.pageNumber + incr, this.filter, this.selectedUserId)\n          .pipe(take(1))\n          .subscribe(\n            (res) => {\n              this.morePages = res.hasNextPage;\n              this.pageNumber = res.pageIndex;\n\n              if (this.posts.length === 0) {\n                this.posts = [];\n              } else {\n                let oldposts = this.posts;\n                this.posts = [];\n                let oldResLen = oldposts.length;\n                for (let i = 0; i < oldResLen; i++) {\n                  this.posts.push(oldposts[i]);\n                }\n              }\n              let resLen = res.items.length;\n              for (let i = 0; i < resLen; i++) {\n                this.posts.push(res.items[i]);\n              }\n              if (event) {\n                event.target.complete();\n              }\n              this.refresh();\n              resolve('done');\n            },\n            async (err) => {\n              console.log(err);\n              if (err.status === 401) {\n                await this.accountService.logout();\n                resolve('done');\n              }\n            }\n          );\n      } else {\n        resolve('done');\n        this.infiniteScroll.disabled = !this.infiniteScroll.disabled;\n      }\n    })\n  }\n\n  refreshPosts(event?: any) {\n    this.postService\n      .postsPageGet(1, this.filter, this.selectedUserId)\n      .pipe(take(1))\n      .subscribe(\n        (res) => {\n          this.morePages = res.hasNextPage;\n          this.pageNumber = res.pageIndex;\n          this.posts = res.items;\n          if (event) {\n            event.target.complete();\n          }\n        },\n        async (err) => {\n          console.log(err);\n          if (err.status === 401) {\n            await this.accountService.logout();\n          }\n        }\n      );\n  }\n\n  async presentSearchModal() {\n    const modal = await this.modalController.create({\n      component: SearchPage,\n      componentProps: {},\n      showBackdrop: true,\n      cssClass: \"search-modal\",\n    });\n    return await modal.present();\n  }\n\n  openProfile() {\n    const navigationExtras: NavigationExtras = {\n      replaceUrl: true,\n      skipLocationChange: true,\n      state: {\n        userId: this.accountService.getUserId(),\n      },\n    };\n    this.zone.run(() => {\n      this.router.navigateByUrl(\"/user-profile\", navigationExtras);\n    });\n  }\n\n  async presentMapFilter() {\n    const modal = await this.modalController.create({\n      component: MapFilterPage,\n      showBackdrop: true,\n      cssClass: \"filter-modal\",\n      componentProps: {\n        filter: this.filter,\n      },\n    });\n\n    modal.onDidDismiss().then(async (dataReturned) => {\n      if (dataReturned !== null) {\n        this.filter = dataReturned.data;\n        this.refreshPosts();\n        await this.loadingController.dismiss();\n      }\n    });\n\n    return await modal.present();\n  }\n\n  refresh() {\n    this.cd.detectChanges();\n  }\n}\n","<ion-header style=\"background-color:#128C7E\">\n  <ion-toolbar color=\"#128C7E\">\n    <ion-grid class=\"header-grid\">\n      <ion-row class=\"ion-align-items-baseline\">\n        <ion-col class=\"ion-justify-content-start\">\n          <ion-buttons class=\"ion-justify-content-start\"> \n            <ion-button class=\"ion-justify-content-start circle-pic\" (click)=\"openProfile()\">\n              <img class=\"img-center circle-pic\" src=\"../../assets/defaultuser.png\">\n            </ion-button>\n          </ion-buttons>\n        </ion-col>\n        <ion-col class=\"ion-justify-self-bottom\"> \n          <img height=\"60px\" width=\"120px\" src=\"../../assets/logos/whiteLogo.png\">\n        </ion-col>\n        <ion-col class=\"ion-justify-content-end\">\n          <ion-buttons class=\"ion-justify-content-end\"> \n            <ion-button class=\"ion-justify-content-end\" (click)=\"presentSearchModal()\">  \n              <img class=\"img-center\" src=\"../../assets/UI/search-outline.svg\" >\n            </ion-button>\n          </ion-buttons>\n        </ion-col>\n      </ion-row>\n    </ion-grid>\n  </ion-toolbar>\n</ion-header>\n<ion-content [fullscreen]=\"false\" color=\"light\">\n  <ion-refresher #refresherRef slot=\"fixed\" (ionRefresh)=\"refreshPosts($event)\">\n    <ion-refresher-content\n      pullingText=\"Pull to refresh\"\n      refreshingSpinner=\"circles\"\n      refreshingText=\"Refreshing...\">\n    </ion-refresher-content>\n  </ion-refresher>\n  <post [posts]=\"posts\"></post>\n  <ion-infinite-scroll threshold=\"100px\" (ionInfinite)=\"getPosts(1, $event)\">\n    <ion-infinite-scroll-content\n      loadingSpinner=\"circles\"\n      loadingText=\"Getting more posts...\">\n    </ion-infinite-scroll-content>\n  </ion-infinite-scroll>\n</ion-content>\n<ion-fab class=\"map-filter-fab\" vertical=\"bottom\">\n  <ion-button fill=\"clear\" (click)=\"presentMapFilter()\">\n    <img src=\"../../assets/UI/FilterClosed.svg\">\n  </ion-button>\n</ion-fab>\n"]}